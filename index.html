<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>IskolarLink</title>

<style>
  :root{
    --maroon: #800000;
    --maroon-dark: #5a0000;
    --gold: #D4A017;
    --bg-url: url('/assets/iskolarbg.png');
  }
  html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, Helvetica, sans-serif;-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}

  /* make top-level app a column flex so injected main/footer can behave */
  #app {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
  }

  /* content area will host header/main/footer from visitorHome.html */
  #content {
    display: flex;
    flex-direction: column;
    flex: 1;            /* IMPORTANT: allows main to grow and push footer down */
    min-height: 0;      /* prevents overflow issues inside flex items */
    opacity: 0;         /* will fade-in once content injected */
    transition: opacity .28s ease;
  }

  /* SPLASH */
  #splash{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
    transition:opacity .6s ease, visibility .6s ease;
    background-image: linear-gradient(rgba(0,0,0,0.28), rgba(0,0,0,0.22)), var(--bg-url);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    padding: 18px;
  }

  /* container that holds text + mayor photo */
  .split{
    display:flex;
    align-items:center;
    justify-content:flex-start; /* no space between */
    gap:0px; /* remove gap completely */
    width:100%;
    max-width:1100px; /* narrower so they appear closer */
    height: min(72vh, 760px);
    box-sizing:border-box;
  }

  /* left text column */
  .text-col{
    position:relative;
    z-index:5;
    flex: 0 0 52%; /* smaller so mayor moves closer */
    color:var(--maroon);
    display:flex;
    flex-direction:column;
    gap:10px;
    min-width:0;
    padding:4px 0; /* almost no padding */
    margin-right:-20px; /* pulls text closer to the photo */
    align-items:flex-start;
  }

  /* large headline — layered animations */
  .headline{
    font-weight:900;
    font-size: clamp(44px, 8.5vw, 110px); /* bigger headline */
    line-height:1.02;
    letter-spacing: -0.02em;
    margin:0;
    display:block;
    position:relative;
    overflow:visible;
    color:var(--maroon);
  }

  /* smaller "Welcome to" line */
  .headline .welcome {
    display:block;
    font-weight:800;
    font-size: clamp(20px, 3.6vw, 34px); /* larger welcome */
    line-height:1.02;
    color: rgba(255,255,255,0.98);
    margin-bottom:6px;
    -webkit-font-smoothing:antialiased;
  }

  /* gradient fill for main headline (keeps maroon as fallback) */
  .headline .gradient {
    background: linear-gradient(90deg, var(--maroon) 0%, #9b1b1b 30%, #d46b1b 60%, var(--gold) 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    display:inline-block;
    background-size: 220% 100%;
    animation: shine 3.2s linear infinite;
  }

  @keyframes shine{
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* typewriter reveal line */
  .subline{
    color: rgba(255,255,255,0.95);
    font-size: clamp(16px, 2.6vw, 24px); /* larger subline */
    font-weight:700;
    opacity:0.98;
    margin:0;
    letter-spacing:0.01em;
    display:inline-block;
    max-width: 64ch;
  }

  /* the typing effect (uses steps) */
  .typewriter {
    display:inline-block;
    border-right: 3px solid rgba(255,255,255,0.92);
    white-space:nowrap;
    overflow:hidden;
    box-sizing: border-box;
    animation:
      typing 3.6s steps(36, end) 0.2s forwards,
      blinkCaret .8s steps(1, end) infinite;
    width: 0;
  }

  @keyframes typing { from { width: 0; } to { width: 100%; } }
  @keyframes blinkCaret { 50% { border-color: transparent; } }

  /* small accent paragraph (we'll use this area for logos) */
  .lead {
    color: rgba(255,255,255,0.92);
    font-size: clamp(14px, 1.8vw, 16px);
    max-width: 60ch;
  }

  .logos {
    display:flex;
    align-items:center;
    gap:22px;
    margin-top:8px;
  }
  .logos img {
    display:block;
    height:160px;
    max-width:360px;
    object-fit:contain;
    object-position:center;
    filter: none;
    background: transparent;
  }

  /* shimmering underline */
  .headline:after{
    content:"";
    display:block;
    height:8px;
    width:200px;
    margin-top:12px;
    border-radius:4px;
    background: linear-gradient(90deg, rgba(212,160,23,.14), rgba(212,160,23,.4));
    transform-origin:left center;
    animation: underlinePop 1s cubic-bezier(.2,.9,.3,1) .7s both;
  }
  @keyframes underlinePop {
    from { transform: scaleX(.14); opacity:0; }
    to { transform: scaleX(1); opacity:1; }
  }

  /* subtle entrance animation for whole text column */
  .text-col { transform: translateY(8px); opacity:0; animation: textIn .85s cubic-bezier(.16,.8,.24,1) .25s both; }
  @keyframes textIn { to { transform: translateY(0); opacity:1; } }

  /* Mayor photo area — fill right side, keep static */
  .mayor-wrap{
    position:relative;
    z-index:4;
    flex: 0 0 40%; /* slightly reduced so text has room and image hugs close */
    display:block;
    min-width:220px;
    height:100%;
    box-sizing:border-box;
    padding-left:0; /* remove left padding to bring it flush with text */
    margin-left:0;
    background: transparent;
  }

  /* make the mayor area fill the wrap */
  .mayor{
    position:absolute;
    right:0;
    bottom:0;
    left:0;
    top:0;
    width:100%;
    height:100%;
    overflow:visible;
    border-radius:0;
    box-shadow:none;
    background:transparent;
    display:flex;
    align-items:flex-end;
    justify-content:center;
    padding:0;
  }

  /* make the <img> show fully (no cropping) — scale and nudge left slightly to reduce gap */
  .mayor img{
    object-fit: contain;
    object-position: center bottom;
    width:105%;    /* slightly larger than container so it visually overlaps closer to text */
    height:105%;
    max-width:none;
    max-height:none;
    display:block;
    border-radius:0;
    box-shadow:none;
    background: transparent;
    transform: translateX(-6%); /* nudge image left to close the visual gap */
  }

  /* Skip button (keyboard users) */
  .skip-btn{
    position:fixed;
    top:14px;
    right:14px;
    z-index:10010;
    background: rgba(255,255,255,0.06);
    color: #fff;
    border:1px solid rgba(255,255,255,0.12);
    padding:8px 12px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    backdrop-filter: blur(4px);
  }
  .skip-btn:focus{ outline:3px solid rgba(212,160,23,0.25); }

  /* fade-out helper when removed */
  .hidden { opacity:0 !important; visibility:hidden !important; pointer-events:none; }

  /* responsive tweaks */
  @media (max-width:1400px){
    .split{max-width:1200px;height:66vh}
    .mayor img { transform: translateX(-4%); width:103%; height:103%; }
    .logos img { height:78px; }
  }
  @media (max-width:1100px){
    .split{max-width:1000px;height:66vh}
  }
  @media (max-width:900px){
    /* stack and stop the left nudge so image doesn't overlap text on small screens */
    .split{ flex-direction:column-reverse; gap:12px; align-items:center; justify-content:flex-start; padding-top:12px; }
    .mayor-wrap{ position:static; padding-left:0; height:auto; display:flex; align-items:center; width:100%; flex: 0 0 auto; }
    .mayor{ position:static; width:100%; height:260px; align-items:center; justify-content:center; }
    .mayor img{ object-position:center center; object-fit:contain; height:100%; width:auto; transform:none; }
    .headline{ font-size: clamp(32px, 9.5vw, 72px); text-align:center; }
    .headline .welcome { text-align:center; display:block; }
    .text-col{ align-items:center; text-align:center; padding:12px; }
    .logos img { height:64px; }
  }
</style>
</head>
<body>
  <button class="skip-btn" id="skipIntro" aria-controls="splash">Skip intro</button>

  <div id="splash" aria-hidden="false" role="dialog" aria-label="IskolarLink welcome">
    <div class="split" role="group" aria-label="Welcome content">
      <!-- left: text (confetti removed) -->
      <div style="position:relative; width:100%; height:100%; max-height:100%;" >
        <div class="text-col" aria-hidden="false">
          <h1 class="headline" aria-hidden="false">
            <span class="welcome">Welcome to</span>
            <span class="gradient">IskolarLink!</span>
          </h1>

          <p class="subline">
            <span class="typewriter" id="typeTxt">An ISKO-KPP Scholarship Management Platform</span>
          </p>

          <div class="lead" id="leadText">
            <div class="logos" aria-hidden="false" aria-label="City and Isko-KPP logos">
              <img src="/assets/citylogo.png" alt="City of Koronadal logo" />
              <img src="/assets/iskologo.png" alt="Isko-KPP logo" />
            </div>
          </div>
        </div>
      </div>

      <!-- right: mayor photo fills right part -->
      <div class="mayor-wrap" aria-hidden="false">
        <div class="mayor" role="img" aria-label="Mayor portrait">
          <img src="/assets/mayor.png" alt="Mayor portrait">
        </div>
      </div>
    </div>
  </div>

  <div id="app">
    <div id="content" aria-live="polite">Loading...</div>
  </div>

<script>

  
  // Load visitor page into content (robust DOMParser-based loader)
  (async function loadVisitor() {
    const contentEl = document.getElementById('content');

    function adoptStyles(doc) {
      // copy <link rel=stylesheet> and <style> into parent head if not present
      const head = document.head;
      doc.querySelectorAll('link[rel="stylesheet"], style').forEach(node => {
        if (node.tagName.toLowerCase() === 'link' && node.href) {
          // avoid duplicate links
          if (!document.querySelector(`link[href="${node.href}"]`)) {
            const l = document.createElement('link');
            l.rel = 'stylesheet';
            l.href = node.href;
            head.appendChild(l);
          }
        } else if (node.tagName.toLowerCase() === 'style') {
          // append style blocks (avoid exact duplicates by text)
          const text = node.textContent || '';
          const exists = Array.from(head.querySelectorAll('style')).some(s => (s.textContent || '') === text);
          if (!exists) head.appendChild(document.importNode(node, true));
        }
      });
    }

    function runInlineScripts(doc) {
      // Execute scripts from the fetched document.
      // For external scripts, we'll append script tags to body (avoiding duplicates).
      const body = document.body;
      doc.querySelectorAll('script').forEach(s => {
        // skip type="application/ld+json" etc.
        const t = (s.type || 'text/javascript').toLowerCase();
        if (t === 'application/ld+json') return;
        if (s.src) {
          if (!document.querySelector(`script[src="${s.src}"]`)) {
            const ext = document.createElement('script');
            ext.src = s.src;
            // preserve async/defer if present
            if (s.async) ext.async = true;
            if (s.defer) ext.defer = true;
            body.appendChild(ext);
          }
        } else {
          const inline = document.createElement('script');
          inline.type = s.type || 'text/javascript';
          inline.text = s.textContent;
          body.appendChild(inline);
        }
      });
    }

    async function injectHTMLFragment(htmlString) {
      const parser = new DOMParser();
      const doc = parser.parseFromString(htmlString, 'text/html');

      // copy stylesheet/style so fetched CSS applies
      adoptStyles(doc);

      // extract header / main / footer (fallbacks if selectors differ)
      const header = doc.querySelector('header') || doc.querySelector('.site-header');
      const main = doc.querySelector('main') || doc.querySelector('main.page-wrap') || doc.querySelector('[role="main"]');
      const footer = doc.querySelector('footer') || doc.querySelector('.site-footer');

      // Clear container
      contentEl.innerHTML = '';

      // append header
      if (header) {
        contentEl.appendChild(document.importNode(header, true));
      }

      // append main — ensure it will flex to push footer down
      if (main) {
        const mainNode = document.importNode(main, true);
        // enforce flex behaviour so footer stays at bottom
        mainNode.style.flex = mainNode.style.flex || '1 0 auto';
        mainNode.style.minHeight = mainNode.style.minHeight || '0';
        contentEl.appendChild(mainNode);
      } else {
        // If no <main> present, create a placeholder so layout stays consistent
        const placeholder = document.createElement('main');
        placeholder.style.flex = '1 0 auto';
        contentEl.appendChild(placeholder);
      }

      // append footer
      if (footer) {
        const footerNode = document.importNode(footer, true);
        // margin-top:auto works because #content is flex column
        footerNode.style.marginTop = footerNode.style.marginTop || 'auto';
        contentEl.appendChild(footerNode);
      }

      // execute scripts from fetched doc
      runInlineScripts(doc);

      // fade content in and call initializer if present
      setTimeout(() => {
        contentEl.style.opacity = '1';
        try {
          if (typeof window.initVisitorHome === 'function') {
            window.initVisitorHome();
          } else {
            window.dispatchEvent(new Event('DOMContentLoaded'));
          }
        } catch (e) {
          console.error('initVisitorHome error', e);
        }
      }, 40);
    }

    try {
      const res = await fetch('/public/visitorHome.html', { cache: 'no-store' });

      // fallback if /public path missing
      if (!res.ok) {
        if (res.status === 404) {
          const fallback = await fetch('/visitorHome.html', { cache: 'no-store' });
          if (fallback.ok) {
            const text = await fallback.text();
            await injectHTMLFragment(text);
            return;
          }
        }
        contentEl.innerHTML = `<p>Unable to load public page (HTTP ${res.status}).</p>`;
        contentEl.style.opacity = '1';
        console.error('Failed to fetch visitor page, status:', res.status);
        return;
      }

      const html = await res.text();
      await injectHTMLFragment(html);
    } catch (err) {
      contentEl.innerHTML = '<p>Unable to load public page (network error).</p>';
      contentEl.style.opacity = '1';
      console.error('Network error fetching visitorHome:', err);
    }
  })();
</script>

<script>
  // Splash lifecycle: hide on skip click or after animation, and ensure Skip disappears
  const splash = document.getElementById('splash');
  const skipBtn = document.getElementById('skipIntro');

  // Hide function that also hides skip button
  function hideSplashNow(){
    if (!splash) return;
    // gracefully hide
    splash.style.transition = 'opacity .45s ease, visibility .45s ease';
    splash.style.opacity = '0';
    splash.setAttribute('aria-hidden','true');

    // hide skip button immediately and remove focus
    if (skipBtn) {
      skipBtn.classList.add('hidden');
      skipBtn.disabled = true;
      try { skipBtn.blur(); } catch(e){}
    }

    // remove from flow after transition
    setTimeout(()=> {
      try { splash.style.display='none'; }catch(e){}
      const content = document.getElementById('content');
      if(content) content.style.opacity='1';

      // *** ADDED: redirect to publicNav after splash ***
      window.location.href = "/public/publicNav.html";  // adjust path if needed
    }, 520);
  }

  // Skip button interactions
  skipBtn.addEventListener('click', hideSplashNow);
  skipBtn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') hideSplashNow(); });

  // Also allow ESC to hide
  window.addEventListener('keydown', (e) => { if (e.key === 'Escape') hideSplashNow(); });

  // decorative pre-hide animation (no movement on mayor)
  function animateSplash(){
    const textCol = document.querySelector('.text-col');
    // small translate to left for text only
    setTimeout(()=> {
      if (textCol) textCol.style.transform = 'translateX(-12px) translateY(-1px) scale(.997)';
      if (textCol) textCol.style.opacity = '0.98';
    }, 3000);

    // then hide overlay entirely
    setTimeout(()=> hideSplashNow(), 4600);
  }

  // Start animation after window load so assets are being fetched
  window.addEventListener('load', ()=> { setTimeout(animateSplash, 250); });

  // Safety: in case page loads slowly, ensure splash auto-hides after 8s
  setTimeout(()=> { if (splash && splash.style.display !== 'none') hideSplashNow(); }, 8000);
</script>
</body>
</html>
